#!/bin/sh

LOCKFILE=$HOME/.cache/syncnclock
LOGDIR=$HOME/.cache/syncnc
CONFIG=$HOME/.config/syncnc

if [ -f "$LOCKFILE" ]; then
    echo "[$(< $LOCKFILE)] already running"
    exit
fi

trap "rm -f $LOCKFILE exit" INT TERM EXIT
echo $$ > $LOCKFILE

mkdir -p $LOGDIR

source $CONFIG/config.env

nextcloudcmd -u "$USERNAME" -p "$PASSWORD" "$DIRECTORY" "$HOST" >> $LOGDIR/stdout 2>> $LOGDIR/stderr 

rm -rf $LOCKFILE
