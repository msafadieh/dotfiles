#!/bin/sh

LOGDIR=$HOME/.cache/syncnc
CONFIG=$HOME/.config/syncnc

mkdir -p "$LOGDIR"

. "$CONFIG/config.env"

run_sync() {
 
    if pid=$(pidof nextcloudcmd); then
        echo "already running on $pid"
        return
    fi

    nextcloudcmd -u "$USERNAME" -p "$PASSWORD" "$DIRECTORY" "$HOST" >> "$LOGDIR/stdout" 2>> "$LOGDIR/stderr"
}

[ "$1" = "-w" ] && loop=1
run_sync
while [ $loop ]
do
    inotifywait -r -e modify -e move -e create -e delete "$DIRECTORY" 
    run_sync
done



